目标：
- 让生产环境的问题处理始终有章可循
- 快速恢复业务，确保业务持续性

补充：
- 故障数据沉淀、运营
- 提升技术风险防控意识

# 1. 故障概述
## 1.1 什么是故障
日常运营中，除用户方环境或自身操作引起的问题外，**其他无论什么原因**导致我们的**服务中断**、**服务品质下降**或**用户服务体验下降**的现象，统称为故障。

## 1.2 故障分级标准
故障分级：P序列、D序列、X序列
- P为基础序列，为故障处理的综合优先级
- D为数据质量故障登记，综合数据资产登记与数据影响因素
- 陆续对非P故障使用X序列进行管理

## 1.3 故障等级定义
蚂蚁全站交易 付款
- 成功率下跌15%及以上：P1
- 成功率下跌5%（含）至15%：P2，超过1小时上升为P1
- 成功率下跌5%以下：P3，超过15分钟上升为P2

## 1.4 故障分类
### 1.4.1 可用性
不可用事件：
- 用户感知的服务不可用或服务使用体验下降到一定程度
- 不同产品/服务可依自身特点选一个或几个核心指标作为可用性衡量

可用率 = 1 - （不可用时长/系统运行时长）*100%

### 1.4.2 资损故障
因技术原因导致用户/公司出现理论资金损失

### 1.4.3 数据质量故障
日常运营中，无论什么原因导致蚂蚁集团服务数据（包括离线、实时、在线等所有数据）错误或数据延迟的现象，称为数据质量故障，但不包括由于用户方环境或用户自身操作引起的问题。

# 2. 故障管理
旨在**最短时间内**恢复业务，将负面影响降到**最低**，同时考虑**如何避免故障再次发生**

## 2.1 故障发现
- 监控报警：业务报警、数据规则检测报警、应用报警、基础设施报警
- 定期巡检：对于业务波动较大不容易通过阈值告警出来的业务，可通过定期巡检发现故障
- 故障自报：代码review，应用日志分析，数据分析等途径发现线上故障
- 内部/外部用户反馈：用户使用时遇到线上问题
- 用户发现定义：“人”使用时遇到问题并反馈在先的统一为用户发现，不区分内部还是外部，如果有系统先报警，但不能确定是故障，同事有用户反馈上来确认为故障的，算用户上报

## 2.2 故障应急4原则
1. 以恢复线上业务为第一要务
2. 故障排查和恢复两条线并行
3. 故障进展信息第一时间同步
4. 故障处理资源调度管理升级

## 2.3 应急流程
业务Owner，BU应急值班长，全站应急值班长

## 2.4 故障恢复手段
- 恢复止血第一位
- 毫无头绪可重启
- 出现问题早升级
- 降级大招常保鲜
- 出现变更先回滚
- 影响范围分析好
- 容量不足降和限
- 保留线程很重要

## 2.5 故障复盘
故障简述->故障处理过程->故障影响面/影响业务线->故障原因分析->故障评级和定责->后续action制定

### 2.5.1 故障处理过程回溯及影响面确认
1. 故障处理过程
 - 明确故障发生、发现、原因定位、故障决策、故障止血、故障影响消除等关键时间点
 - 如涉及多方并行处理的复杂故障，故障处理过程可从单个处理角色角度展开

2. 故障影响面确认 
 - 实际业务影响，如交易下跌幅度等
 - 是否有资损，理论资损量，实际资损量
 - 舆情影响：媒体报道、大V转发、微博回复
 - 服务量：来电量、在线客服、工单量等
 - 可用性影响：按照各业务线运维可用率标准计算

### 2.5.2 定责基本原则
所有故障判责优先尊重稳定性设计原则、生产红线

- 变更三板斧优先级最高，若故障违反可变更、可灰度、可应急的原则，或者未经过CR，相关团队承担主要责任
- 核心服务依赖非核心服务，由核心服务方承担主要责任
- 若变更发布触发别人bug，且变更发布符合接口调用规则、流量及变更的流程规范，由bug方承担主要责任，否则由变更方承担主要责任

## 2.6 持续改进
- 缩短故障发现与处理时长
 * 监控改进
 * 应急流程改进
 * 快速恢复改进
- 避免类似问题再次发生
 * 代码改进
 * 容灾改进
 * 测试改进
